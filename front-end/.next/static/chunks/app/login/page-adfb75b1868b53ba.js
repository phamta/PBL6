(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4520],{5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},5731:(e,t,a)=>{"use strict";a.d(t,{KB:()=>c,PE:()=>d,Sn:()=>i,ZQ:()=>l,vQ:()=>u});var r=a(3464);let s="http://localhost:3001/api/v1",o=r.A.create({baseURL:s,timeout:3e4,headers:{"Content-Type":"application/json"},withCredentials:!0});o.interceptors.request.use(e=>{var t;let a=localStorage.getItem("token");return a&&(e.headers.Authorization="Bearer ".concat(a)),console.log("\uD83D\uDE80 API Request: ".concat(null==(t=e.method)?void 0:t.toUpperCase()," ").concat(e.url)),e},e=>(console.error("❌ Request Error:",e),Promise.reject(e))),o.interceptors.response.use(e=>{var t;return console.log("✅ API Response: ".concat(null==(t=e.config.method)?void 0:t.toUpperCase()," ").concat(e.config.url," - ").concat(e.status)),e},e=>{var t;return console.error("❌ Response Error:",e),(null==(t=e.response)?void 0:t.status)===401&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)});let i={auth:{login:"/auth/login",logout:"/auth/logout",profile:"/auth/profile",refresh:"/auth/refresh"},admin:{users:"/admin/users",roles:"/admin/roles",systemLogs:"/admin/system-logs",statistics:"/admin/statistics"},mou:{base:"/mou",export:"/reports/mou/excel"},visa:{base:"/visa",export:"/reports/visa/excel"},visitor:{base:"/visitor",export:"/reports/visitor/excel"},translation:{base:"/translation",export:"/reports/translation/excel"},reports:{dashboard:"/reports/dashboard",export:"/reports/export"}},n={get:async(e,t)=>(await o.get(e,t)).data,post:async(e,t,a)=>(await o.post(e,t,a)).data},l={login:async e=>n.post(i.auth.login,e),logout:async()=>n.post(i.auth.logout),getProfile:async()=>n.get(i.auth.profile),refreshToken:async()=>n.post(i.auth.refresh)},c=(e,t)=>{let a=new URL(e,s);return t&&Object.entries(t).forEach(e=>{let[t,r]=e;a.searchParams.append(t,String(r))}),a.toString()},d=async(e,t)=>{let a=localStorage.getItem("token"),r=await fetch(c(e),{headers:{Authorization:"Bearer ".concat(a)}});if(r.ok){let e=await r.blob(),a=window.URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download=t,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s)}else throw Error("Download failed")},u={name:"Hệ thống Quản l\xfd Hợp t\xe1c Quốc tế",universityName:"Trường Đại học B\xe1ch Khoa Đ\xe0 Nẵng",version:"1.0.0",pagination:{defaultPageSize:10,maxPageSize:100}}},6804:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),s=a(2115),o=a(5695),i=a(9323),n=a(8497);function l(){let[e,t]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),p=(0,o.useRouter)(),v=async t=>{t.preventDefault(),d(!0),m("");try{let t=await i._.login({email:e,password:a});if(t.success&&t.data){let e=t.data.user.role||n.g.USER,a=(e=>{switch(e){case n.g.ADMIN:return"/dashboard/admin";case n.g.STUDENT:return"/dashboard/student";case n.g.SPECIALIST:return"/dashboard/specialist";case n.g.MANAGER:return"/dashboard/manager";case n.g.VIEWER:return"/dashboard/viewer";case n.g.USER:default:return"/dashboard"}})(e);console.log("Redirecting ".concat(e," to: ").concat(a)),p.push(a)}else m(t.message||"Đăng nhập thất bại")}catch(e){var r,s,o;console.error("Login error:",e),(null==(r=e.response)?void 0:r.status)===401?m("Email hoặc mật khẩu kh\xf4ng đ\xfang"):(null==(o=e.response)||null==(s=o.data)?void 0:s.message)?m(e.response.data.message):"ERR_NETWORK"===e.code||e.message.includes("Network Error")?m("Kh\xf4ng thể kết nối đến server. Vui l\xf2ng kiểm tra backend c\xf3 đang chạy kh\xf4ng."):e.message?m(e.message):m("Đăng nhập thất bại. Vui l\xf2ng thử lại.")}finally{d(!1)}};return(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Đăng nhập hệ thống"}),(0,r.jsx)("p",{className:"mt-2 text-center text-sm text-gray-600",children:"PBL6 - Hệ thống Quản l\xfd Hợp t\xe1c Quốc tế"}),(0,r.jsxs)("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Th\xf4ng tin đăng nhập:"}),(0,r.jsxs)("div",{className:"text-xs text-blue-700 space-y-1",children:[(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"Email:"})," admin@htqt.edu.vn"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"Mật khẩu:"})," 123456"]}),(0,r.jsxs)("p",{className:"mt-2 text-red-600",children:[(0,r.jsx)("strong",{children:"Lưu \xfd:"})," Backend phải chạy tr\xean localhost:3001"]})]})]})]}),(0,r.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:v,children:[(0,r.jsxs)("div",{className:"rounded-md shadow-sm -space-y-px",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"sr-only",children:"Email"}),(0,r.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Địa chỉ email",value:e,onChange:e=>t(e.target.value)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"sr-only",children:"Mật khẩu"}),(0,r.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm",placeholder:"Mật khẩu",value:a,onChange:e=>l(e.target.value)})]})]}),u&&(0,r.jsx)("div",{className:"text-red-600 text-sm text-center",children:u}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:c,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Đang đăng nhập...":"Đăng nhập"})}),(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("button",{type:"button",onClick:()=>{i._.removeToken(),i._.removeUser(),localStorage.clear(),m(""),alert("Đ\xe3 x\xf3a dữ liệu cache. Vui l\xf2ng thử đăng nhập lại.")},className:"text-sm text-gray-500 hover:text-gray-700 underline",children:"X\xf3a dữ liệu cache (nếu gặp lỗi)"})})]})]})})}},7974:(e,t,a)=>{Promise.resolve().then(a.bind(a,6804))},8497:(e,t,a)=>{"use strict";a.d(t,{S:()=>i,g:()=>s});var r=a(9323);let s={ADMIN:"admin",USER:"user",STUDENT:"student",SPECIALIST:"specialist",MANAGER:"manager",VIEWER:"viewer",SYSTEM:"system"},o={[s.ADMIN]:["user:create","user:read","user:update","user:delete","user:assign_role","system:config","system:backup","system:logs","data:view_all","report:view","report:export","report:stats","notification:manage","visa:create","visa:read","visa:update","visa:delete","visa:review","visa:approve","visa:reject","visa:assign","visa:export","mou:create","mou:read","mou:update","mou:delete","mou:review","mou:approve","mou:sign","mou:terminate","mou:assign","mou:export","translation:create","translation:read","translation:update","translation:delete","translation:review","translation:approve","translation:certify","visitor:create","visitor:read","visitor:update","visitor:delete","visitor:approve","visitor:export"],[s.USER]:["data:view_department","visa:create","visa:read","visa:update","mou:create","mou:read","mou:update","translation:create","translation:read","translation:update","visitor:create","visitor:read","visitor:update"],[s.STUDENT]:["data:view_own","visa:create","visa:read","visa:update"],[s.SPECIALIST]:["data:view_all","visa:read","visa:review","visa:assign","mou:read","mou:review","mou:assign","translation:read","translation:review","translation:certify","visitor:read","visitor:update","report:view","report:export"],[s.MANAGER]:["data:view_all","visa:read","visa:approve","visa:reject","visa:export","mou:read","mou:approve","mou:sign","mou:terminate","mou:export","translation:read","translation:approve","visitor:read","visitor:approve","visitor:export","report:view","report:export","report:stats"],[s.VIEWER]:["data:view_public","visa:read","mou:read","translation:read","visitor:read","report:view"],[s.SYSTEM]:["notification:send","data:view_all","visa:read","mou:read"]},i=()=>{let e=r._.getUser(),t=t=>!!(null==e?void 0:e.role)&&(o[e.role]||[]).includes(t),a=t=>{if(!(null==e?void 0:e.role))return!1;let a=o[e.role]||[];return t.some(e=>a.includes(e))};return{hasPermission:t,hasAnyPermission:a,hasAllPermissions:t=>{if(!(null==e?void 0:e.role))return!1;let a=o[e.role]||[];return t.every(e=>a.includes(e))},canAccessData:e=>{switch(e){case"own":return a(["data:view_own","data:view_department","data:view_all"]);case"department":return a(["data:view_department","data:view_all"]);case"all":return t("data:view_all");case"public":return a(["data:view_public","data:view_own","data:view_department","data:view_all"]);default:return!1}},canAccessModule:(e,a)=>t("".concat(e,":").concat(a)),getRoleDisplayName:e=>({[s.ADMIN]:"Admin CNTT",[s.USER]:"Người d\xf9ng cơ sở",[s.STUDENT]:"Sinh vi\xean/Học vi\xean quốc tế",[s.SPECIALIST]:"Chuy\xean vi\xean HTQT/KHCN&ĐN",[s.MANAGER]:"L\xe3nh đạo Ph\xf2ng",[s.VIEWER]:"Người d\xf9ng tra cứu",[s.SYSTEM]:"Hệ thống"})[e]||e||"Kh\xf4ng x\xe1c định",can:{createUser:()=>t("user:create"),manageUsers:()=>t("user:read"),assignRoles:()=>t("user:assign_role"),configureSystem:()=>t("system:config"),viewSystemLogs:()=>t("system:logs"),createMOU:()=>t("mou:create"),viewMOU:()=>t("mou:read"),editMOU:()=>t("mou:update"),deleteMOU:()=>t("mou:delete"),reviewMOU:()=>t("mou:review"),approveMOU:()=>t("mou:approve"),signMOU:()=>t("mou:sign"),terminateMOU:()=>t("mou:terminate"),exportMOU:()=>t("mou:export"),createVisa:()=>t("visa:create"),viewVisa:()=>t("visa:read"),editVisa:()=>t("visa:update"),deleteVisa:()=>t("visa:delete"),reviewVisa:()=>t("visa:review"),approveVisa:()=>t("visa:approve"),rejectVisa:()=>t("visa:reject"),exportVisa:()=>t("visa:export"),createTranslation:()=>t("translation:create"),viewTranslation:()=>t("translation:read"),editTranslation:()=>t("translation:update"),deleteTranslation:()=>t("translation:delete"),reviewTranslation:()=>t("translation:review"),approveTranslation:()=>t("translation:approve"),certifyTranslation:()=>t("translation:certify"),createVisitor:()=>t("visitor:create"),viewVisitor:()=>t("visitor:read"),editVisitor:()=>t("visitor:update"),deleteVisitor:()=>t("visitor:delete"),approveVisitor:()=>t("visitor:approve"),exportVisitor:()=>t("visitor:export"),viewReports:()=>t("report:view"),exportReports:()=>t("report:export"),viewStatistics:()=>t("report:stats")},userRole:null==e?void 0:e.role,isAdmin:(null==e?void 0:e.role)===s.ADMIN,isUser:(null==e?void 0:e.role)===s.USER,isStudent:(null==e?void 0:e.role)===s.STUDENT,isSpecialist:(null==e?void 0:e.role)===s.SPECIALIST,isManager:(null==e?void 0:e.role)===s.MANAGER,isViewer:(null==e?void 0:e.role)===s.VIEWER,isSystem:(null==e?void 0:e.role)===s.SYSTEM}}},9323:(e,t,a)=>{"use strict";a.d(t,{_:()=>s});var r=a(5731);let s={login:async e=>{try{console.log("\uD83D\uDD11 Attempting login...",{email:e.email});let t=await r.ZQ.login(e);if(t.access_token&&t.user)return s.setToken(t.access_token),s.setUser(t.user),console.log("✅ Login successful"),{success:!0,data:t,message:"Login successful"};return console.log("❌ Login failed: Invalid response format"),{success:!1,message:"Invalid response from server"}}catch(e){var t,a,o,i;return console.error("❌ Login error:",e),{success:!1,message:(null==(a=e.response)||null==(t=a.data)?void 0:t.message)||e.message||"Login failed",errors:(null==(i=e.response)||null==(o=i.data)?void 0:o.errors)||[e.message]}}},setToken:e=>{localStorage.setItem("token",e),document.cookie="token=".concat(e,"; path=/; max-age=86400")},getToken:()=>localStorage.getItem("token"),removeToken:()=>{localStorage.removeItem("token"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT"},setUser:e=>{localStorage.setItem("user",JSON.stringify(e)),document.cookie="user=".concat(encodeURIComponent(JSON.stringify(e)),"; path=/; max-age=86400")},getUser:()=>{{let e=localStorage.getItem("user");return e?JSON.parse(e):null}},removeUser:()=>{localStorage.removeItem("user"),document.cookie="user=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT"},isAuthenticated:()=>!!localStorage.getItem("token"),requireAuth:()=>({isLoading:!1,user:null}),hasRole:(e,t)=>t===e||"admin"===t,hasPermission:(e,t)=>"admin"===t,mockLogin:e=>{let t="mock_token_"+Date.now();s.setToken(t),s.setUser({id:1,username:"demo_user",email:"demo@example.com",role:e,name:"Demo User"})},logout:()=>{s.removeToken(),s.removeUser(),window.location.href="/login"}}}},e=>{e.O(0,[3464,8441,5964,7358],()=>e(e.s=7974)),_N_E=e.O()}]);